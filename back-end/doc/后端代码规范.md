# Java后端代码规范

## 1. 项目结构规范

### 1.1 分层架构标准

采用经典的三层架构，确保代码职责清晰、易于维护：

```
back-end/
├── src/main/java/
│   └── com/cloudbase/
│       ├── controller/        # 控制器层，处理HTTP请求和响应
│       ├── service/           # 业务逻辑层，实现核心业务逻辑
│       ├── repository/        # 数据访问层，负责与数据库交互
│       ├── entity/            # 实体层，对应数据库表结构
│       ├── dto/               # 数据传输对象，用于前后端数据交互
│       ├── config/            # 配置类，如Spring配置、数据源配置等
│       ├── exception/         # 异常处理类，定义自定义异常
│       ├── utils/             # 工具类，提供通用功能
│       └── Application.java   # 应用启动类
├── src/main/resources/
│   ├── application.yml        # 应用配置文件
│   ├── application-dev.yml    # 开发环境配置
│   ├── application-prod.yml   # 生产环境配置
│   └── mapper/                # MyBatis映射文件
├── pom.xml                    # Maven依赖管理
└── README.md                  # 项目说明文档
```

### 1.2 包命名规范

- 包名使用小写字母，采用反向域名命名方式
- 包名应反映模块的功能职责
- 示例：`com.cloudbase.controller`, `com.cloudbase.service`

### 1.3 配置文件组织

- 使用YAML格式的配置文件（application.yml）
- 按环境分离配置：开发环境（dev）、生产环境（prod）
- 敏感配置（如数据库密码）应通过环境变量或配置中心管理
- 配置项命名应清晰明了，使用小写字母和连字符

## 2. 编码规范

### 2.1 命名约定

- **类名**：使用驼峰命名法，首字母大写，如 `UserController`
- **方法名**：使用驼峰命名法，首字母小写，如 `getUserById`
- **变量名**：使用驼峰命名法，首字母小写，如 `userId`
- **常量**：使用全大写，单词间用下划线分隔，如 `MAX_PAGE_SIZE`
- **参数名**：使用驼峰命名法，首字母小写，如 `userId`
- **包名**：使用小写字母，单词间用点分隔，如 `com.cloudbase.service`

### 2.2 代码注释标准

- **类注释**：每个类都应有Javadoc注释，说明类的功能、作者、创建日期等
  ```java
  /**
   * 用户控制器，处理用户相关的HTTP请求
   * @author 开发者
   * @since 2026-02-16
   */
  @RestController
  public class UserController {
  }
  ```

- **方法注释**：每个方法都应有Javadoc注释，说明方法的功能、参数、返回值和异常
  ```java
  /**
   * 根据用户ID获取用户信息
   * @param userId 用户ID
   * @return 用户信息
   * @throws UserNotFoundException 用户不存在时抛出
   */
  public User getUserById(Long userId) throws UserNotFoundException {
  }
  ```

- **行注释**：对于复杂的业务逻辑，应添加行注释说明
  ```java
  // 计算用户积分，基础积分+额外积分
  int score = baseScore + extraScore;
  ```

### 2.3 代码格式要求

- **缩进**：使用4个空格进行缩进，不使用制表符
- **空格**：运算符两侧、逗号后应加空格
- **大括号**：左大括号与语句同行，右大括号独占一行
- **空行**：方法之间、逻辑块之间应添加空行
- **行宽**：每行代码不超过120个字符

## 3. 技术栈规范

### 3.1 Spring Boot使用规范

- **版本**：使用Spring Boot 3.0+版本
- **依赖管理**：通过Maven BOM统一管理依赖版本
- **注解使用**：合理使用Spring注解，避免过度使用
- **配置方式**：优先使用Java Config，减少XML配置

### 3.2 数据库访问层规范

- **ORM框架**：使用MyBatis-Plus或JPA
- **SQL编写**：复杂SQL应写在XML文件中，简单SQL可使用注解
- **事务管理**：使用`@Transactional`注解管理事务，明确事务边界
- **连接池**：使用HikariCP作为数据库连接池

### 3.3 API接口设计规范

- **RESTful风格**：遵循RESTful API设计原则
- **HTTP方法**：合理使用GET、POST、PUT、DELETE等方法
- **路径命名**：使用小写字母和连字符，如 `/api/users/list`
- **参数传递**：路径参数用于资源标识，查询参数用于过滤和分页
- **响应格式**：统一响应格式，包含状态码、消息和数据
  ```json
  {
    "code": 200,
    "message": "success",
    "data": {}
  }
  ```

### 3.4 异常处理规范

- **自定义异常**：定义业务相关的自定义异常
- **全局异常处理**：使用`@RestControllerAdvice`实现全局异常处理
- **异常分类**：区分业务异常和系统异常
- **异常信息**：异常信息应清晰明了，便于排查问题

## 4. 安全规范

### 4.1 输入验证要求

- **参数校验**：使用`@Valid`和`@Validated`注解进行参数校验
- **校验规则**：使用JSR-380注解定义校验规则，如`@NotNull`、`@Size`等
- **防注入**：对用户输入进行严格验证，防止SQL注入、XSS攻击等

### 4.2 SQL注入防护

- **参数化查询**：使用PreparedStatement或MyBatis的参数绑定
- **避免拼接SQL**：禁止直接拼接SQL语句
- **权限控制**：实施最小权限原则，限制数据库用户权限

### 4.3 敏感信息处理

- **密码加密**：使用BCrypt等算法对密码进行加密存储
- **敏感数据传输**：使用HTTPS协议传输敏感数据
- **日志脱敏**：对日志中的敏感信息进行脱敏处理
- **配置信息**：敏感配置信息应通过环境变量或配置中心管理

## 5. 性能规范

### 5.1 数据库查询优化

- **索引使用**：合理创建和使用索引
- **查询优化**：避免全表扫描，使用分页查询
- **批量操作**：对于大量数据操作，使用批量处理
- **连接管理**：使用连接池，避免频繁创建和关闭连接

### 5.2 缓存使用规范

- **缓存策略**：合理使用缓存，如Redis
- **缓存键设计**：缓存键应唯一且有意义
- **缓存过期**：设置合理的缓存过期时间
- **缓存一致性**：确保缓存与数据库数据的一致性

### 5.3 资源管理要求

- **资源关闭**：使用try-with-resources语句确保资源正确关闭
- **线程管理**：合理使用线程池，避免线程泄露
- **内存管理**：避免内存泄漏，如未关闭的流、未释放的连接等
- **文件操作**：大文件操作应使用缓冲流，避免一次性加载到内存

## 6. 日志记录规范

- **日志框架**：使用SLF4J作为日志门面，Logback作为实现
- **日志级别**：合理使用DEBUG、INFO、WARN、ERROR等日志级别
- **日志内容**：日志内容应清晰明了，包含必要的上下文信息
- **异常日志**：记录异常时应包含完整的异常堆栈信息
- **性能考虑**：避免在高频调用的方法中使用DEBUG级别日志

## 7. 测试规范

- **测试框架**：使用JUnit 5和Mockito进行单元测试
- **测试覆盖**：核心业务逻辑的测试覆盖率应达到80%以上
- **集成测试**：使用Spring Boot Test进行集成测试
- **测试命名**：测试类和测试方法命名应清晰反映测试内容

## 8. 代码审查规范

- **审查工具**：使用SonarQube等工具进行代码质量扫描
- **审查流程**：建立代码审查流程，确保代码质量
- **审查重点**：代码风格、业务逻辑、异常处理、安全性等
- **审查记录**：记录代码审查结果和改进建议

## 9. 最佳实践

1. **单一职责原则**：每个类和方法应只负责一项功能
2. **开闭原则**：对扩展开放，对修改关闭
3. **依赖倒置原则**：依赖抽象，不依赖具体实现
4. **接口隔离原则**：使用多个小接口，不使用大而全的接口
5. **里氏替换原则**：子类应能替换父类而不影响程序功能

6. **使用Optional处理空值**：避免NullPointerException
7. **使用Stream API处理集合**：简化集合操作代码
8. **使用Lambda表达式**：简化函数式接口的实现
9. **使用枚举类型**：表示有限的常量集合
10. **使用常量类**：集中管理常量，提高代码可维护性

## 10. 附则

- 本规范适用于所有Java后端代码开发
- 开发人员应严格遵守本规范
- 规范将根据项目实际情况和技术发展进行更新
- 如有疑问，应及时与团队讨论确定