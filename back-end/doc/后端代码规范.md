# Java 后端代码规范

## 1. 项目结构规范

### 1.1 分层架构标准
建议采用经典的四层架构，确保各层职责清晰：
- **Controller 层**：负责 API 接口定义、请求参数校验及响应包装。不应包含业务逻辑。
- **Service 层**：核心业务逻辑实现层。包含业务逻辑处理、事务控制、第三方服务调用。
- **Mapper/DAO 层**：数据库访问层，负责数据的增删改查。
- **Entity/Domain 层**：数据库实体映射类（Entity）及业务模型（BO/DTO/VO）。

### 1.2 包命名规范
- 基础包名：`com.[company].[project].[module]`
- 控制器层：`com.[...].controller`
- 业务接口：`com.[...].service`
- 业务实现：`com.[...].service.impl`
- 数据访问：`com.[...].mapper` 或 `com.[...].dao`
- 实体类：`com.[...].entity`
- 数据传输对象：`com.[...].dto`
- 视图对象：`com.[...].vo`

### 1.3 配置文件组织
- 核心配置：`application.yml`
- 环境配置：`application-dev.yml` (开发), `application-test.yml` (测试), `application-prod.yml` (生产)
- 敏感信息：应通过环境变量或加密工具（如 Jasypt）处理。

## 2. 编码规范

### 2.1 命名约定
- **类名**：使用大驼峰命名法（PascalCase），如 `UserService`。
- **方法名/变量名**：使用小驼峰命名法（camelCase），如 `getUserById`。
- **常量**：全部大写，单词间用下划线分隔，如 `MAX_PAGE_SIZE`。
- **抽象类**：以 `Abstract` 或 `Base` 开头。
- **异常类**：以 `Exception` 结尾。

### 2.2 代码注释标准
- **类注释**：必须包含作者、创建日期及功能描述。
- **方法注释**：必须说明方法功能、参数含义、返回值及可能抛出的异常。建议使用 Javadoc 格式。
- **行注释**：在代码上方或右侧简单说明逻辑，避免冗余。

### 2.3 代码格式要求
- 缩进使用 4 个空格。
- 左大括号 `{` 不换行，右大括号 `}` 独占一行。
- 运算符前后必须有空格。

## 3. 技术栈规范

### 3.1 Spring Boot 使用规范
- 依赖注入建议使用构造器注入（Constructor Injection）而非 `@Autowired` 字段注入。
- 使用 `@ConfigurationProperties` 管理自定义配置。
- 启动类应放在根包下，避免扫描范围问题。

### 3.2 数据库访问层规范
- **MyBatis-Plus**：推荐使用以简化 CRUD，复杂查询在 XML 中实现。
- **分页查询**：必须使用物理分页（如插件），禁止在内存中手动分页。
- **逻辑删除**：建议使用全局配置实现逻辑删除。

### 3.3 API 接口设计规范
- 遵循 RESTful 风格。
- **统一响应格式**：所有接口返回 `Result<T>` 对象，包含 `code`, `message`, `data`。
- **版本控制**：接口路径建议包含版本号，如 `/api/v1/users`。

### 3.4 异常处理规范
- **全局异常拦截**：使用 `@RestControllerAdvice` 统一处理异常。
- **自定义异常**：根据业务场景定义 `BusinessException`，避免直接抛出 `RuntimeException`。
- **禁止吞掉异常**：catch 块中必须有日志记录或重新抛出。

## 4. 安全规范

### 4.1 输入验证要求
- 使用 `hibernate-validator` (@Valid, @NotNull 等) 进行请求参数校验。
- 禁止信任任何前端传入的参数，关键业务逻辑需在 Service 层二次校验。

### 4.2 SQL 注入防护
- 使用参数化查询（MyBatis 的 `#{}`），严禁使用 `${}` 拼接 SQL（除非是排序字段等受控场景）。

### 4.3 敏感信息处理
- 密码必须加密存储（建议使用 BCrypt）。
- 返回数据时应脱敏敏感字段（如手机号、身份证号）。

## 5. 性能规范

### 5.1 数据库查询优化
- 禁止使用 `SELECT *`，只查询需要的字段。
- 核心字段必须建立索引，禁止全表扫描。
- 避免在循环中执行数据库查询。

### 5.2 缓存使用规范
- 读多写少的场景引入 Redis 缓存。
- 注意缓存穿透、雪崩、击穿问题。
- 设置合理的过期时间。

### 5.3 资源管理要求
- 所有的流操作（InputStream/OutputStream）必须在 `try-with-resources` 中关闭。
- 线程池需手动创建（使用 `ThreadPoolExecutor`），禁止使用 `Executors` 的默认实现。
